<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Canadian Fitness Repair</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.gomaps.pro/gomaps.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/appointment-tracker.css">
</head>
<body>
    <!-- Mobile Menu Button -->
    <div class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"><i class="fas fa-spinner"></i></div>
        <div>Loading dashboard...</div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="brand">
            <i class="fas fa-dumbbell"></i>
            <h2>Fitness Repair</h2>
        </div>
        <!-- Sidebar -->
        <button class="close-sidebar-mobile">
            <i class="fas fa-times"></i>
          </button>

        <div class="nav-links">
            <a href="#" data-view="dashboard" class="active">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" data-view="calendar">
                <i class="fas fa-calendar-alt"></i>
                <span>Calendar</span>
            </a>
            <a href="#" data-view="customers">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
            <a href="#" data-view="reports">
                <i class="fas fa-chart-pie"></i>
                <span>Reports</span>
            </a>
            <a href="#" data-view="logs">
                <i class="fas fa-clipboard-list"></i>
                <span>Logs</span>
              </a>
              
            <a href="#" data-view="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
            <a href="#" data-view="help">
                <i class="fas fa-question-circle"></i>
                <span>Help Center</span>
            </a>
            <a href="#" data-view="logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div>
                        <div id="user-name">admin@fitnessrepair.com</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="tab-content active">

            <div class="grid grid-cols-4 gap-4 card-grid">
            <div class="card" id="total-appointments-card" data-status="All">
                <div class="card-header">
                <div class="card-title">Total Appointments</div>
                <div class="card-icon"><i class="fas fa-calendar"></i></div>
                </div>
                <div class="card-content" id="total-appointments">0</div>
                <div class="card-footer">
                <i class="fas fa-arrow-up"></i> <span id="total-appointments-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="scheduled-card" data-status="Scheduled / Confirmed">
                <div class="card-header">
                <div class="card-title">Scheduled</div>
                <div class="card-icon"><i class="fas fa-clock"></i></div>
                </div>
                <div class="card-content" id="scheduled-count">0</div>
                <div class="card-footer">
                <i class="fas fa-plus"></i> <span id="scheduled-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="inprogress-card" data-status="In Progress">
                <div class="card-header">
                <div class="card-title">In Progress</div>
                <div class="card-icon"><i class="fas fa-tools"></i></div>
                </div>
                <div class="card-content" id="inprogress-count">0</div>
                <div class="card-footer">
                <i class="fas fa-exclamation-triangle"></i><span id="inprogress-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="awaiting-parts-card" data-status="Awaiting Parts">
                <div class="card-header">
                <div class="card-title">Awaiting Parts</div>
                <div class="card-icon"><i class="fas fa-hourglass-half"></i></div>
                </div>
                <div class="card-content" id="awaiting-parts-count">0</div>
                <div class="card-footer">
                <i class="fas fa-clock"></i><span id="awaiting-parts-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="parts-arrived-card" data-status="Parts Arrived">
                <div class="card-header">
                <div class="card-title">Parts Arrived</div>
                <div class="card-icon"><i class="fas fa-box-open"></i></div>
                </div>
                <div class="card-content" id="parts-arrived-count">0</div>
                <div class="card-footer">
                <i class="fas fa-truck"></i><span id="parts-arrived-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="scheduled-installation-card" data-status="Scheduled for Parts Installation">
                <div class="card-header">
                <div class="card-title">Scheduled for Parts Installation</div>
                <div class="card-icon"><i class="fas fa-tools"></i></div>
                </div>
                <div class="card-content" id="scheduled-installation-count">0</div>
                <div class="card-footer">
                <i class="fas fa-calendar-check"></i><span id="scheduled-installation-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="repaired-card" data-status="Repaired">
                <div class="card-header">
                <div class="card-title">Repaired</div>
                <div class="card-icon"><i class="fas fa-wrench"></i></div>
                </div>
                <div class="card-content" id="repaired-count">0</div>
                <div class="card-footer">
                <i class="fas fa-check"></i><span id="repaired-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="completed-card" data-status="Completed">
                <div class="card-header">
                <div class="card-title">Completed</div>
                <div class="card-icon"><i class="fas fa-check-circle"></i></div>
                </div>
                <div class="card-content" id="completed-count">0</div>
                <div class="card-footer">
                <i class="fas fa-arrow-up"></i><span id="completed-text">Loading...</span>
                </div>
            </div>
        
            <div class="card" id="cancelled-card" data-status="Cancelled">
                <div class="card-header">
                <div class="card-title">Cancelled</div>
                <div class="card-icon"><i class="fas fa-times-circle"></i></div>
                </div>
                <div class="card-content" id="cancelled-count">0</div>
                <div class="card-footer">
                <i class="fas fa-ban"></i><span id="cancelled-text">Loading...</span>
                </div>
            </div>
            </div> <!-- end grid -->
        
            <!-- Charts Section -->
            <div>
            <div class="card">
                <div class="card-header">
                <div class="card-title">Appointments Status Overview</div>
                <div class="card-icon">
                    <i class="fas fa-chart-pie"></i>
                </div>
                </div>
                <div style="height: 350px;">
                <canvas id="appointmentsStatusChart"></canvas>
                </div>
            </div>
        
            <div class="card">
                <div class="card-header">
                <div class="card-title">Appointments This Month</div>
                <div class="card-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                </div>
        
                <div id="monthYearLabel" style="text-align: center; font-weight: bolder; font-size: 1.5rem; margin: 10px 0; color: #fff;"></div>
        
                <div style="height: 350px;">
                <canvas id="appointmentsPerDayChart"></canvas>
                </div>
        
                <div style="margin: 10px 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <button id="prevMonthBtn" class="btn">‚Üê Previous</button>
                <button id="nextMonthBtn" class="btn">Next ‚Üí</button>
                </div>
            </div>
            </div> <!-- end charts section -->
        
        </div> <!-- end dashboard-view -->
  

        <!-- Appointments View -->
        <div id="appointments-view" class="tab-content">
            <div style="margin-bottom: 25px; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                <button id="add-appointment" class="btn">
                    <i class="fas fa-plus"></i> Add Appointment
                </button>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <input type="text" id="search-appointments" class="form-control" placeholder="Search appointments..." style="min-width: 250px;">
                    <button class="btn" id="print-schedule"><i class="fas fa-print"></i> Print</button>
                    <button id="export-appointments" class="btn secondary">
                        <i class="fas fa-file-export"></i> Export CSV
                      </button>                      
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Equipment</th>
                            <th>Date & Time</th>
                            <th>Status</th>
                            <th>Price</th>
                            <th>Confirm</th>
                            <th>Actions</th>
                            <th>Directions</th>
                            <th>Distance</th>
                        </tr>
                    </thead>
                    <tbody id="appointments-body">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading appointments...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px; flex-wrap: wrap; gap: 15px;">
                <button id="prev-page" class="btn secondary" disabled>Previous</button>
                <div id="page-indicator">Page 1 of 1</div>
                <button id="next-page" class="btn" disabled>Next</button>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="tab-content">
            <div class="calendar-header">
                <h2 id="current-month-year">Loading...</h2>
                <div class="calendar-nav">
                    <button id="prev-month" class="btn secondary"><i class="fas fa-chevron-left"></i> Prev</button>
                    <button id="next-month" class="btn">Next <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Month Summary</div>
                        <div class="card-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div>
                            <div class="card-content" id="summary-total">0</div>
                            <div class="card-footer">Total Appointments</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-days">0</div>
                            <div class="card-footer">Business Days</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-revenue">$0</div>
                            <div class="card-footer">Revenue</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-utilization">0%</div>
                            <div class="card-footer">Utilization</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Performance Metrics</div>
                        <div class="card-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div>
                            <div class="card-content" id="current-appointments">0</div>
                            <div class="card-footer">Current</div>
                        </div>
                        <div>
                            <div class="card-content" id="monthly-released">0</div>
                            <div class="card-footer">Completed</div>
                        </div>
                        <div>
                            <div class="card-content" id="monthly-revenue">$0</div>
                            <div class="card-footer">Revenue</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="calendar-grid" id="calendar-days">
                <!-- Calendar days will be populated dynamically -->
            </div>
        </div>

        <!-- Customers View -->
        <div id="customers-view" class="tab-content">
            <div style="margin-bottom: 25px; display: flex; flex-wrap: wrap; gap: 10px;">
                <button id="add-customer" class="btn">
                    <i class="fas fa-user-plus"></i> Add Customer
                </button>
                <button id="backfill-customers-btn" class="btn" style="background-color: #ff9800; color: white;">
                    <i class="fas fa-database"></i> Backfill Customers from Appointments
                </button>
            </div>            
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Equipment</th>
                            <th>Last Appointment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customers-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading customers...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="reports-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Performance Reports</div>
                    <div class="card-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
                
                <div style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="card">
                            <div class="card-content" style="font-size: 2.5rem;">$4,280</div>
                            <div class="card-footer">Monthly Revenue</div>
                        </div>
                        <div class="card">
                            <div class="card-content" style="font-size: 2.5rem;">42</div>
                            <div class="card-footer">Completed Repairs</div>
                        </div>
                        <div class="card">
                            <div class="card-content" style="font-size: 2.5rem;">78%</div>
                            <div class="card-footer">Utilization Rate</div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <div class="card-title">Repair Completion Time</div>
                        </div>
                        <div style="height: 300px;">
                            <canvas id="repairTimeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Revenue by Equipment Type</div>
                        </div>
                        <div style="height: 300px;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn">
                            <i class="fas fa-file-export"></i> Export Report (PDF)
                        </button>
                        <button class="btn secondary" style="margin-left: 15px;">
                            <i class="fas fa-download"></i> Download Data (CSV)
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Logs View -->
        <div id="logs-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Activity Logs</div>
                    <div class="card-icon">
                    <i class="fas fa-clipboard-list"></i>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                    <thead>
                        <tr>
                        <th>Type</th>
                        <th>Appointment ID</th>
                        <th>Email</th>
                        <th>SMS</th>
                        <th>Status</th>
                        <th>Timestamp</th>
                        <th>Error</th>
                        </tr>
                    </thead>
                    <tbody id="logs-body">
                        <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            <i class="fas fa-spinner fa-spin"></i> Loading logs...
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <button id="prev-log-page" class="btn secondary">Previous</button>
                    <div id="log-page-indicator">Page 1</div>
                    <button id="next-log-page" class="btn">Next</button>
                  </div>                  
            </div>
        </div>
  
        <div id="settings-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Account Settings</div>
                    <div class="card-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
                
                <div style="padding: 20px;">
                    <form id="settings-form">
                        <h3 style="margin-bottom: 15px; color: var(--dark-accent);">Profile</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label>Full Name</label>
                                <input type="text" id="settings-full-name" class="form-control" placeholder="Enter your name">
                                <div class="validation-error" id="settings-full-name-error"></div>
                            </div>
                            <div>
                                <label>Email</label>
                                <input type="email" id="settings-email" class="form-control" placeholder="Enter your email" disabled>
                            </div>
                        </div>
                        
                        <h3 style="margin-bottom: 15px; color: var(--dark-accent);">Business Settings</h3>
                        <div style="margin-bottom: 20px;">
                            <label>Business Name</label>
                            <input type="text" id="settings-business-name" class="form-control" placeholder="Enter business name">
                            <div class="validation-error" id="settings-business-name-error"></div>
                        </div>
                        
                        <!-- NEW: Province Selection -->
                        <div style="margin-bottom: 20px;">
                            <label>Business Province</label>
                            <select id="business-province" class="form-control">
                                <option value="ON">Ontario</option>
                                <option value="QC">Quebec</option>
                                <option value="BC">British Columbia</option>
                                <option value="AB">Alberta</option>
                                <option value="MB">Manitoba</option>
                                <option value="SK">Saskatchewan</option>
                                <option value="NS">Nova Scotia</option>
                                <option value="NB">New Brunswick</option>
                                <option value="NL">Newfoundland and Labrador</option>
                                <option value="PE">Prince Edward Island</option>
                                <option value="NT">Northwest Territories</option>
                                <option value="NU">Nunavut</option>
                                <option value="YT">Yukon</option>
                            </select>
                        </div>
                        
                        <!-- NEW: Timezone Selection -->
                        <div style="margin-bottom: 20px;">
                            <label>Business Timezone</label>
                            <select id="timezone" class="form-control">
                                <option value="America/Toronto">Eastern (Toronto)</option>
                                <option value="America/Vancouver">Pacific (Vancouver)</option>
                                <option value="America/Edmonton">Mountain (Edmonton)</option>
                                <option value="America/Winnipeg">Central (Winnipeg)</option>
                                <option value="America/Halifax">Atlantic (Halifax)</option>
                                <option value="America/St_Johns">Newfoundland (St. John's)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label>Business Hours</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <input type="time" id="settings-start-time" class="form-control">
                                    <div class="card-footer" style="text-align: center; padding: 5px;">Opening Time</div>
                                </div>
                                <div>
                                    <input type="time" id="settings-end-time" class="form-control">
                                    <div class="card-footer" style="text-align: center; padding: 5px;">Closing Time</div>
                                </div>
                            </div>
                        </div>
                        
                        <h3 style="margin-bottom: 15px; color: var(--dark-accent);">Notification Preferences</h3>
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <input type="checkbox" id="email-notifications" checked>
                                <label for="email-notifications">Email Notifications
                                <span id="email-notification-status" class="notification-status"></span>
                                </label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="sms-notifications">
                                <label for="sms-notifications">SMS Notifications
                                <span id="sms-notification-status" class="notification-status"></span>
                                <button type="button" id="test-sms-btn" class="btn" style="margin-left: 15px;">
                                    <i class="fas fa-paper-plane"></i> Test SMS
                                </button>
                                </label>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label>Admin Phone Number (for SMS)</label>
                            <input type="tel" id="admin-phone" class="form-control" placeholder="e.g., 4161234567">
                            <div class="validation-error" id="admin-phone-error"></div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label>Mobile Carrier (for SMS Notifications)</label>
                            <select id="sms-carrier" class="form-control">
                                <option value="rogers">Rogers</option>
                                <option value="bell">Bell</option>
                                <option value="telus">Telus</option>
                                <option value="fido">Fido</option>
                                <option value="virgin">Virgin Mobile</option>
                                <option value="koodo">Koodo</option>
                                <option value="freedom">Freedom Mobile</option>
                                <option value="public">Public Mobile</option>
                                <option value="sasktel">SaskTel</option>
                                <option value="videotron">Videotron</option>
                            </select>
                        </div>
        
                        <div class="form-actions">
                            <button type="button" id="save-settings" class="btn">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <button type="button" id="cancel-settings" class="btn secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="help-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Help Center</div>
                    <div class="card-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                </div>
                
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--dark-accent);">Frequently Asked Questions</h3>
                    
                    <div class="faq-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--dark-border);">
                        <div style="font-weight: bold; margin-bottom: 5px;">How do I reschedule an appointment?</div>
                        <div>Go to the Appointments view, click the edit button next to the appointment, and change the date/time.</div>
                    </div>
                    
                    <div class="faq-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--dark-border);">
                        <div style="font-weight: bold; margin-bottom: 5px;">How do I add a new customer?</div>
                        <div>Go to the Customers view and click the "Add Customer" button.</div>
                    </div>
                    
                    <div class="faq-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--dark-border);">
                        <div style="font-weight: bold; margin-bottom: 5px;">How do I print the daily schedule?</div>
                        <div>In the Appointments view, use the "Print" button at the top right.</div>
                    </div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--dark-accent);">Contact Support</h3>
                    
                    <form id="support-form">
                        <div style="margin-bottom: 20px;">
                            <label>Subject</label>
                            <input type="text" id="support-subject" class="form-control">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label>Message</label>
                            <textarea class="form-control" id="support-message" rows="4"></textarea>
                        </div>
                        
                        <button class="btn">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </form>
                    
                    <div style="margin-top: 30px; background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 10px;">
                        <h4 style="margin-bottom: 10px;"><i class="fas fa-phone-alt"></i> Phone Support</h4>
                        <div>1-289-925-7239 (9am-5pm EST)</div>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 10px;"><i class="fas fa-envelope"></i> Email Support</h4>
                        <div>canadianfitnessrepair@gmail.com</div>
                    </div>
                </div>
            </div>
        </div>           
    </div>


  <!-- Appointment Modal -->
<div id="appointment-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2 id="modal-title"><i class="fas fa-calendar-plus"></i> Add New Appointment</h2>
    
    <!-- Progress Bar -->
    <div class="progress" style="height: 8px; background: #374151; border-radius: 4px; margin-bottom: 20px; overflow: hidden;">
      <div id="form-progress" class="progress-bar" style="height: 100%; background: #3b82f6; width: 25%;"></div>
    </div>
    
    <!-- Step Navigation -->
    <div id="step-navigation" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
      <button class="btn secondary prev-step" disabled><i class="fas fa-arrow-left"></i> Back</button>
      <div id="step-indicator">Step 1 of 4</div>
      <button class="btn next-step">Next <i class="fas fa-arrow-right"></i></button>
    </div>
    
    <!-- Form Steps -->
    <form id="appointment-form">
      <!-- STEP 1: Customer Information -->
      <div id="step-1" class="form-step active">
        <h3><i class="fas fa-user"></i> Customer Information</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <label>Customer Name</label>
            <input type="text" id="customer-name" class="form-control" placeholder="Enter customer name" required>
            <div class="validation-error" id="customer-name-error"></div>
          </div>
          <div>
            <label>Phone Number</label>
            <input type="tel" id="customer-phone" class="form-control" placeholder="Enter phone number">
          </div>
        </div>
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label for="customer-email">Email Address</label>
          <input type="email" id="customer-email" class="form-control" placeholder="example@email.com">
        </div>
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label for="customer-carrier">Carrier</label>
          <div style="display: flex; gap: 10px;">
            <select id="customer-carrier" class="form-control" style="flex: 1;">
              <option value="">-- Select Carrier --</option>
              <!-- Options remain same -->
            </select>
            <button type="button" class="btn secondary" id="lookup-carrier" style="white-space: nowrap;">
              <i class="fas fa-search"></i> Lookup
            </button>
          </div>
        </div>
      </div>
      
      <!-- STEP 2: Appointment Details -->
      <div id="step-2" class="form-step">
        <h3><i class="fas fa-map-marker-alt"></i> When & Where?</h3>
        
        <div style="margin-bottom: 20px; position: relative;">
          <label for="house-address-input">House Address</label>
          <input type="text" id="house-address-input" class="form-control" name="houseAddress" 
                 placeholder="Enter house address" required autocomplete="off">
          <ul id="address-suggestions" style="/* existing styles */"></ul>
          
          <div id="gomaps-widget" data-api-key="AlzaSyT7Sa-m79jL64rRoxfdkn7k6wlFRwiJX0c"
               style="margin-bottom: 10px;"></div>
          
          <div class="validation-error" id="house-address-error"></div>
          <p>
            <strong>Distance:</strong> <span id="gomaps-distance" style="color: inherit;">0</span> km
          </p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <label>Date</label>
            <input type="date" id="appointment-date" class="form-control" required>
            <div class="validation-error" id="appointment-date-error"></div>
          </div>
          <div>
            <label>Time</label>
            <input type="time" id="appointment-time" class="form-control" required>
            <div class="validation-error" id="appointment-time-error"></div>
          </div>
        </div>
      </div>
      
      <!-- STEP 3: Equipment & Service -->
      <div id="step-3" class="form-step">
        <h3><i class="fas fa-dumbbell"></i> Equipment & Service</h3>
        
        <div style="margin-bottom: 20px;">
          <label>Equipment</label>
          <input type="text" id="equipment" class="form-control" placeholder="Enter equipment type">
          <div class="validation-error" id="equipment-error"></div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label>Issue Description</label>
          <textarea id="issue-description" class="form-control" placeholder="Describe the issue"></textarea>
          <div class="validation-error" id="issue-description-error"></div>
        </div>
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label>Service Price (before tax)</label>
          <input type="number" id="appointment-base-price" class="form-control" step="0.01" placeholder="0.00">
        </div>
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label>Tax</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
              <input type="text" id="appointment-tax-rate" class="form-control" readonly>
              <div class="card-footer" style="text-align: center; padding: 5px;">Rate</div>
            </div>
            <div>
              <input type="number" id="appointment-tax-amount" class="form-control" readonly>
              <div class="card-footer" style="text-align: center; padding: 5px;">Amount</div>
            </div>
          </div>
        </div>
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label>Total Price (including tax)</label>
          <input type="number" id="appointment-price" class="form-control" readonly>
        </div>
      </div>
      
      <!-- STEP 4: Final Details & Confirmation -->
      <div id="step-4" class="form-step">
        <h3><i class="fas fa-check-circle"></i> Review & Confirm</h3>
        
        <div id="confirmation-summary" style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <!-- Summary will be inserted here by JavaScript -->
        </div>
        
        <div style="margin-bottom: 20px;">
          <label>Repair Notes</label>
          <textarea id="repair-notes" class="form-control" placeholder="Add repair notes"></textarea>
          <div class="validation-error" id="repair-notes-error"></div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label>Status</label>
          <select id="appointment-status" class="form-control">
            <!-- Options remain same -->
          </select>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label>
            <input type="checkbox" id="reminder-enabled" />
            Send reminder 24 hours before appointment
          </label>
        </div>
      </div>
      
      <!-- Form Actions (will be moved to step 4 later) -->
      <div class="form-actions">
        <button type="button" id="save-appointment" class="btn">Save Appointment</button>
        <button type="button" id="cancel-appointment" class="btn secondary">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Customer Modal -->
<div id="customer-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 id="customer-modal-title"><i class="fas fa-user-plus"></i> Add New Customer</h2>
        <form id="customer-form">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>Full Name</label>
                    <input type="text" id="customer-modal-name" class="form-control" placeholder="Enter full name" required>
                    <span id="name-error" class="error-message"></span> <!-- Error message for full name -->
                </div>
                <div>
                    <label>Phone Number</label>
                    <input type="tel" id="customer-modal-phone" class="form-control" placeholder="Enter phone number (e.g., 5555555555)">
                    <span id="phone-error" class="error-message"></span> <!-- Error message for phone -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label>Email Address</label>
                <input type="email" id="customer-modal-email" class="form-control" placeholder="Enter email address (e.g., example@domain.com)">
                <span id="email-error" class="error-message"></span> <!-- Error message for email -->
            </div>
            
            <div style="margin-bottom: 20px;">
                <label>Address</label>
                <input type="text" id="customer-modal-address" class="form-control" placeholder="Enter address">
                <span id="address-error" class="error-message"></span> <!-- Error message for address -->
            </div>

            <!-- New Equipment Field -->
            <div style="margin-bottom: 20px;">
                <label>Equipment</label>
                <input type="text" id="customer-modal-equipment" class="form-control" placeholder="Enter equipment (e.g., Treadmill)">
                <span id="equipment-error" class="error-message"></span> <!-- Error message for equipment -->
            </div>

            <!-- New Last Appointment Field -->
            <div style="margin-bottom: 20px;">
                <label>Last Appointment Date</label>
                <input type="date" id="customer-modal-last-appointment" class="form-control">
                <span id="last-appointment-error" class="error-message"></span> <!-- Error message for last appointment -->
            </div>

            <div style="margin-bottom: 20px;">
                <label>Notes</label>
                <textarea id="customer-modal-notes" class="form-control" placeholder="Add customer notes"></textarea>
                <span id="notes-error" class="error-message"></span> <!-- Error message for notes -->
            </div>
            
            <!-- Loading spinner (hidden initially) -->
            <div id="loading-spinner" class="spinner" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> Saving...
            </div>

            <div class="form-actions">
                <button type="button" id="save-customer" class="btn">Save Customer</button>
                <button type="button" id="cancel-customer" class="btn secondary">Cancel</button>
                <!-- Reset button to clear form -->
                <button type="button" id="reset-customer" class="btn secondary">Reset Form</button>
            </div>
        </form>
    </div>
</div>


    <!-- Preview Message Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-modal" id="close-preview-icon">&times;</span>
            <h2 id="previewModalTitle">üì© Message Preview</h2>
            <small id="previewTypeLabel" style="color: gray; margin-left: 5px;"></small>            
    
        <h4>Email Preview</h4>
        <textarea id="emailPreview" class="form-control" rows="10" readonly></textarea>
    
        <h4 style="margin-top: 20px;">SMS Preview</h4>
        <textarea id="smsPreview" class="form-control" rows="4" readonly></textarea>
        <small id="smsCharCount" style="color: gray; display: block; margin-top: 4px;">
            0 / 160 characters
          </small>          
        <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
            <button id="editPreviewBtn" class="btn secondary" onclick="enableEditing()">‚úèÔ∏è Edit</button>
            <button id="savePreviewBtn" class="btn primary" style="display: none;" onclick="saveEditedPreview()">üíæ Save Changes</button>
            <button id="resetPreviewBtn" class="btn danger" disabled>üóë Reset to Default</button>
            <button class="btn" id="close-preview-btn">‚ùå Close</button>
          </div>          
        </div>
    </div>
  
   <script type="module" src="appointment-tracker.js"></script>
  <script src="https://cdn.gomaps.pro/autocomplete/gomaps-autocomplete.min.js"></script>
</body>
</html>
