<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Canadian Fitness Repair</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #95a5a6;
            --sidebar-width: 250px;
            --header-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .brand {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .brand h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .nav-links {
            padding: 20px 0;
        }
        
        .nav-links a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid var(--secondary);
        }
        
        .nav-links a i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            padding-top: 80px;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 90;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            flex: 1;
        }
        
        .tab.active {
            background: var(--secondary);
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .card-content {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .card-footer {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: all 0.3s ease;
            color: var(--gray);
        }
        
        .action-btn:hover {
            background: #f1f1f1;
            color: var(--secondary);
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-scheduled {
            background: rgba(93, 93, 255, 0.1);
            color: #5d5dff;
        }
        
        .status-draft {
            background: rgba(149, 165, 166, 0.1);
            color: #95a5a6;
        }
        
        .status-released {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .status-inprogress {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        
        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        
        .status-warning {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }
        
        /* Calendar */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: 600;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .calendar-day {
            min-height: 100px;
            background: white;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .calendar-day.empty {
            background: transparent;
            box-shadow: none;
        }
        
        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .appointment-item {
            background: #e3f2fd;
            padding: 5px;
            border-radius: 3px;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }
        
        .btn {
            padding: 10px 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            background: #333;
            color: white;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.error {
            background: var(--danger);
        }
        
        /* Loading overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            flex-direction: column;
            display: none;
        }
        
        #loading-overlay .spinner {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .brand h2, .sidebar .nav-links a span {
                display: none;
            }
            
            .sidebar .nav-links a {
                justify-content: center;
                padding: 15px;
            }
            
            .sidebar .nav-links a i {
                margin-right: 0;
                font-size: 1.4rem;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .header {
                left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"><i class="fas fa-spinner"></i></div>
        <div>Loading data...</div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="brand">
            <h2>Admin Dashboard</h2>
        </div>
        <div class="nav-links">
            <a href="#" data-view="dashboard" class="active">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" data-view="appointments">
                <i class="fas fa-calendar-check"></i>
                <span>Appointments</span>
            </a>
            <a href="#" data-view="calendar">
                <i class="fas fa-calendar-alt"></i>
                <span>Calendar</span>
            </a>
            <a href="#" data-view="customers">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
            <a href="#" data-view="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="#" data-view="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
            <a href="#" data-view="help">
                <i class="fas fa-question-circle"></i>
                <span>Help</span>
            </a>
            <a href="#" data-view="logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h2>Dashboard Overview</h2>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div>
                        <div id="user-name">admin@example.com</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="appointments">Appointments</div>
            <div class="tab" data-tab="calendar">Calendar</div>
            <div class="tab" data-tab="customers">Customers</div>
            <div class="tab" data-tab="reports">Reports</div>
            <div class="tab" data-tab="settings">Settings</div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="tab-content active">
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Total Appointments</div>
                        <div class="card-icon" style="background: rgba(93, 93, 255, 0.1); color: #5d5dff;">
                            <i class="fas fa-calendar"></i>
                        </div>
                    </div>
                    <div class="card-content" id="total-appointments">0</div>
                    <div class="card-footer">Loading data...</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Scheduled</div>
                        <div class="card-icon" style="background: rgba(52, 152, 219, 0.1); color: #3498db;">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="card-content" id="scheduled-count">0</div>
                    <div class="card-footer">Loading data...</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">In Progress</div>
                        <div class="card-icon" style="background: rgba(243, 156, 18, 0.1); color: #f39c12;">
                            <i class="fas fa-tools"></i>
                        </div>
                    </div>
                    <div class="card-content" id="inprogress-count">0</div>
                    <div class="card-footer">Loading data...</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Completed</div>
                        <div class="card-icon" style="background: rgba(46, 204, 113, 0.1); color: #2ecc71;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="card-content" id="released-count">0</div>
                    <div class="card-footer">Loading data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Appointments Overview</div>
                </div>
                <div style="height: 300px;">
                    <canvas id="appointmentsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Appointments View -->
        <div id="appointments-view" class="tab-content">
            <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <button id="add-appointment" class="btn">
                    <i class="fas fa-plus"></i> Add Appointment
                </button>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="search-appointments" placeholder="Search appointments..." style="padding: 10px; border-radius: 5px; border: 1px solid #ddd; min-width: 250px;">
                    <button class="btn" id="print-schedule"><i class="fas fa-print"></i> Print</button>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Equipment</th>
                            <th>Date & Time</th>
                            <th>Status</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appointments-body">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading appointments...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                <button id="prev-page" class="btn" disabled>Previous</button>
                <div id="page-indicator">Page 1 of 1</div>
                <button id="next-page" class="btn" disabled>Next</button>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="tab-content">
            <div class="calendar-header">
                <h2 id="current-month-year">June 2023</h2>
                <div class="calendar-nav">
                    <button id="prev-month" class="btn"><i class="fas fa-chevron-left"></i> Prev</button>
                    <button id="next-month" class="btn">Next <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Month Summary</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div>
                            <div class="card-content" id="summary-total">0</div>
                            <div class="card-footer">Total Appointments</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-days">0</div>
                            <div class="card-footer">Business Days</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-revenue">$0</div>
                            <div class="card-footer">Revenue</div>
                        </div>
                        <div>
                            <div class="card-content" id="summary-utilization">0%</div>
                            <div class="card-footer">Utilization</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Performance Metrics</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div>
                            <div class="card-content" id="current-appointments">0</div>
                            <div class="card-footer">Current</div>
                        </div>
                        <div>
                            <div class="card-content" id="monthly-released">0</div>
                            <div class="card-footer">Completed</div>
                        </div>
                        <div>
                            <div class="card-content" id="monthly-revenue">$0</div>
                            <div class="card-footer">Revenue</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="calendar-grid" id="calendar-days">
                <!-- Calendar days will be populated dynamically -->
            </div>
        </div>

        <!-- Customers View -->
        <div id="customers-view" class="tab-content">
            <div style="margin-bottom: 20px;">
                <button id="add-customer" class="btn">
                    <i class="fas fa-plus"></i> Add Customer
                </button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Favorite Equipment</th>
                            <th>Last Appointment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customers-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading customers...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Reports View -->
        <div id="reports-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Monthly Repair Report</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <button id="generate-monthly-report" class="btn" style="margin-right: 10px;">
                        <i class="fas fa-sync"></i> Generate Report
                    </button>
                    <button id="export-reports" class="btn">
                        <i class="fas fa-download"></i> Export to PDF
                    </button>
                </div>
                
                <div style="height: 300px;">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Completed Repairs</div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Customer</th>
                                <th>Equipment</th>
                                <th>Completion Date</th>
                                <th>Revenue</th>
                                <th>Repair Time</th>
                            </tr>
                        </thead>
                        <tbody id="completed-repairs-body">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 20px;">
                                    No data available. Generate report first.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Settings View -->
        <div id="settings-view" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">General Settings</div>
                </div>
                <div style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label>Company Name</label>
                        <input type="text" id="company-name" class="form-control" value="Canadian Fitness Repair">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Default Appointment Price ($)</label>
                        <input type="number" id="default-price" class="form-control" value="150">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Business Hours</label>
                        <input type="text" id="business-hours" class="form-control" value="9:00 AM - 6:00 PM">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Allow Editing Past Appointments</label>
                        <select id="enable-past-edits" class="form-control">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button id="save-settings" class="btn">Save Settings</button>
                        <button id="reset-settings" class="btn" style="background: #95a5a6;">Reset to Default</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointment-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-title">Add New Appointment</h2>
            <form id="appointment-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label>Customer Name</label>
                        <input type="text" id="customer-name" required>
                    </div>
                    <div>
                        <label>Phone Number</label>
                        <input type="tel" id="customer-phone">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label>Date</label>
                        <input type="date" id="appointment-date" required>
                    </div>
                    <div>
                        <label>Time</label>
                        <input type="time" id="appointment-time" required>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Equipment</label>
                    <input type="text" id="equipment">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Price ($)</label>
                    <input type="number" id="appointment-price" value="150">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Issue Description</label>
                    <textarea id="issue-description" rows="3"></textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Repair Notes</label>
                    <textarea id="repair-notes" rows="3"></textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Status</label>
                    <select id="appointment-status">
                        <option value="scheduled">Scheduled</option>
                        <option value="draft">Draft</option>
                        <option value="in_progress">In Progress</option>
                        <option value="needs_parts">Needs Parts</option>
                        <option value="parts_ordered">Parts Ordered</option>
                        <option value="repair_completed">Repair Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="button" id="save-appointment" class="btn">Save Appointment</button>
                    <button type="button" id="cancel-appointment" class="btn" style="background: #95a5a6;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customer-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="customer-modal-title">Add New Customer</h2>
            <form id="customer-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label>Full Name</label>
                        <input type="text" id="customer-name" required>
                    </div>
                    <div>
                        <label>Phone Number</label>
                        <input type="tel" id="customer-phone" required>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Email Address</label>
                    <input type="email" id="customer-email">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Address</label>
                    <input type="text" id="customer-address">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Notes</label>
                    <textarea id="customer-notes" rows="3"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="button" id="save-customer" class="btn">Save Customer</button>
                    <button type="button" id="cancel-customer" class="btn" style="background: #95a5a6;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Script -->
    <script type="module">
        console.log("âœ… Admin dashboard initialized");
        
        // ================ FIREBASE INITIALIZATION ================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import {
            getFirestore,
            collection,
            getDocs,
            addDoc,
            updateDoc,
            deleteDoc,
            doc,
            Timestamp,
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import {
            getAuth,
            onAuthStateChanged,
            signOut,
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        async function getFirebaseConfig() {
            try {
                const response = await fetch(
                    "https://cfr-backend-1.onrender.com/api/firebase-config"
                );
                return await response.json();
            } catch (error) {
                console.error("Error fetching Firebase config:", error);
                showToast("Failed to initialize Firebase", true);
                return null;
            }
        }

        (async () => {
            const firebaseConfig = await getFirebaseConfig();
            if (!firebaseConfig) {
                showToast("App configuration failed to load.", true);
                return;
            }

            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            const appointmentsCollection = collection(db, "appointments");
            const customersCollection = collection(db, "customers");

            // Start your app logic
            initApp(auth, db, appointmentsCollection, customersCollection);
        })();
        
        // ================ UTILITY FUNCTIONS ================
        function showLoading(show = true) {
            const loadingElement = document.getElementById('loading-overlay');
            if (loadingElement) {
                loadingElement.style.display = show ? 'flex' : 'none';
            }
        }
        
        function showToast(message, isError = false) {
            const toast = document.createElement("div");
            toast.className = `toast ${isError ? "error" : ""}`;
            toast.textContent = message;
            document.getElementById("toast-container").appendChild(toast);
            
            setTimeout(() => toast.classList.add("show"), 100);
            setTimeout(() => {
                toast.classList.remove("show");
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function formatTimestamp(dateObj) {
            if (!dateObj) return "N/A";
            
            try {
                return dateObj.toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
            } catch (e) {
                return "Invalid Date";
            }
        }
        
        // ================ MAIN APPLICATION ================
        function initApp(auth, db, appointmentsCollection, customersCollection) {
            // ================ GLOBAL STATE ================
            let appointments = [];
            let customers = [];
            let editingAppointmentId = null;
            let editingCustomerId = null;
            let chartInstance = null;
            let currentMonth = new Date().getMonth();
            let currentYear = new Date().getFullYear();
            let currentPage = 1;
            const appointmentsPerPage = 10;
            
            // Status map for appointments
            const statusMap = {
                scheduled: { text: "Scheduled", class: "status-scheduled" },
                draft: { text: "Draft", class: "status-draft" },
                released: { text: "Released", class: "status-released" },
                in_progress: { text: "In Progress", class: "status-inprogress" },
                cancelled: { text: "Cancelled", class: "status-cancelled" },
                needs_parts: { text: "Needs Parts", class: "status-warning" },
                parts_ordered: { text: "Parts Ordered", class: "status-inprogress" },
                repair_completed: { text: "Completed", class: "status-released" }
            };
            
            // ================ VIEW MANAGEMENT ================
            function activateView(viewName) {
                // Update sidebar active state
                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.classList.toggle('active', link.dataset.view === viewName);
                });
                
                // Hide all views
                document.querySelectorAll('.tab-content').forEach(view => {
                    view.classList.remove('active');
                });
                
                // Show requested view
                const viewElement = document.getElementById(`${viewName}-view`);
                if (viewElement) viewElement.classList.add('active');
                
                // Initialize view-specific content
                switch(viewName) {
                    case "dashboard":
                        updateStats();
                        initChart();
                        break;
                    case "appointments":
                        fetchAppointments();
                        break;
                    case "calendar":
                        renderCalendar();
                        updateCalendarSummary();
                        break;
                    case "customers":
                        fetchCustomers();
                        break;
                    case "reports":
                        generateReports();
                        break;
                    case "settings":
                        loadSettings();
                        break;
                }
            }
            
            // ================ AUTHENTICATION HANDLING ================
            onAuthStateChanged(auth, (user) => {
                if (!user) {
                    window.location.href = "admin-login.html";
                } else {
                    // Show logged-in user's email
                    document.getElementById("user-name").textContent = user.email;
                    fetchAppointments();
                }
            });
            
            // Logout function
            function logout() {
                if (confirm("Are you sure you want to logout?")) {
                    signOut(auth)
                        .then(() => {
                            window.location.href = "admin-login.html";
                        })
                        .catch((error) => {
                            console.error("Logout error:", error);
                            showToast("Logout failed", true);
                        });
                }
            }
            
            // ================ DATA MANAGEMENT ================
            // Fetch appointments from Firestore
            async function fetchAppointments() {
                showLoading(true);
                try {
                    const snapshot = await getDocs(appointmentsCollection);
                    appointments = snapshot.docs.map((doc) => {
                        const data = doc.data();
                        return {
                            id: doc.id,
                            ...data,
                            dateObj: data.date ? data.date.toDate() : new Date()
                        };
                    });
                    renderAppointmentsTable();
                    updateStats();
                    renderCalendar();
                    updateCalendarSummary();
                    initChart();
                } catch (error) {
                    console.error("Error fetching appointments:", error);
                    showToast("Failed to fetch appointments", true);
                } finally {
                    showLoading(false);
                }
            }
            
            // Fetch customers from Firestore
            async function fetchCustomers() {
                showLoading(true);
                try {
                    const snapshot = await getDocs(customersCollection);
                    customers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderCustomersTable();
                } catch (error) {
                    console.error("Error fetching customers:", error);
                    showToast("Failed to load customers", true);
                } finally {
                    showLoading(false);
                }
            }
            
            // Save (add or update) appointment in Firestore
            async function saveAppointment(data) {
                showLoading(true);
                try {
                    if (editingAppointmentId) {
                        const docRef = doc(db, "appointments", editingAppointmentId);
                        await updateDoc(docRef, data);
                        showToast("Appointment updated successfully");
                    } else {
                        await addDoc(appointmentsCollection, data);
                        showToast("Appointment added successfully");
                    }
                    editingAppointmentId = null;
                    await fetchAppointments();
                    document.getElementById('appointment-modal').classList.remove('active');
                } catch (error) {
                    console.error("Error saving appointment:", error);
                    showToast("Failed to save appointment", true);
                } finally {
                    showLoading(false);
                }
            }
            
            // Delete appointment from Firestore
            async function deleteAppointment(id) {
                if (!confirm("Are you sure you want to delete this appointment?")) return;
                
                showLoading(true);
                try {
                    await deleteDoc(doc(db, "appointments", id));
                    showToast("Appointment deleted successfully");
                    await fetchAppointments();
                } catch (error) {
                    console.error("Error deleting appointment:", error);
                    showToast("Failed to delete appointment", true);
                } finally {
                    showLoading(false);
                }
            }
            
            // Save customer to Firestore
            async function saveCustomer() {
                showLoading(true);
                const customerData = {
                    name: document.getElementById('customer-name').value.trim(),
                    phone: document.getElementById('customer-phone').value.trim(),
                    email: document.getElementById('customer-email').value.trim(),
                    address: document.getElementById('customer-address').value.trim(),
                    notes: document.getElementById('customer-notes').value.trim(),
                    createdAt: new Date().toISOString()
                };
                
                try {
                    if (editingCustomerId) {
                        await updateDoc(doc(db, "customers", editingCustomerId), customerData);
                        showToast("Customer updated!");
                    } else {
                        await addDoc(customersCollection, customerData);
                        showToast("Customer added!");
                    }
                    document.getElementById('customer-modal').classList.remove('active');
                    fetchCustomers();
                } catch (error) {
                    showToast("Failed to save customer", true);
                } finally {
                    showLoading(false);
                }
            }
            
            // ================ RENDERING FUNCTIONS ================
            // Render appointments table
            function renderAppointmentsTable(list = appointments) {
                const tbody = document.getElementById("appointments-body");
                tbody.innerHTML = "";
                
                if (list.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                No appointments found
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const start = (currentPage - 1) * appointmentsPerPage;
                const pageApps = list.slice(start, start + appointmentsPerPage);
                
                pageApps.forEach((app) => {
                    const statusInfo = statusMap[app.status] || {
                        text: app.status || "",
                        class: "",
                    };
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>#${app.id}</td>
                        <td>${app.customer}</td>
                        <td>${app.equipment || ""}</td>
                        <td>${formatTimestamp(app.dateObj)}</td>
                        <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                        <td>$${app.price || 0}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${app.id}" aria-label="Edit appointment"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" data-id="${app.id}" aria-label="Delete appointment"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add click listeners to buttons
                tbody.querySelectorAll(".edit-btn").forEach((btn) => {
                    btn.onclick = () => openEditModal(btn.dataset.id);
                });
                
                tbody.querySelectorAll(".delete-btn").forEach((btn) => {
                    btn.onclick = () => deleteAppointment(btn.dataset.id);
                });
                
                // Update page indicator
                const totalPages = Math.ceil(list.length / appointmentsPerPage);
                document.getElementById("page-indicator").textContent = `Page ${currentPage} of ${totalPages || 1}`;
                
                // Enable/disable pagination buttons
                document.getElementById("prev-page").disabled = currentPage === 1;
                document.getElementById("next-page").disabled = currentPage >= totalPages;
            }
            
            // Render customers table
            function renderCustomersTable() {
                const tbody = document.getElementById('customers-body');
                tbody.innerHTML = '';
                
                if (customers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">
                                No customers found
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                customers.forEach(customer => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.email || '-'}</td>
                        <td>${customer.favoriteEquipment || '-'}</td>
                        <td>${customer.lastAppointment || 'Never'}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${customer.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${customer.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Attach event listeners to each edit/delete button
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', () => openEditCustomerModal(btn.dataset.id));
                });
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (confirm("Are you sure you want to delete this customer?")) {
                            deleteCustomer(btn.dataset.id);
                        }
                    });
                });
            }
            
            // Delete customer
            async function deleteCustomer(id) {
                showLoading(true);
                try {
                    await deleteDoc(doc(db, "customers", id));
                    showToast("Customer deleted successfully");
                    fetchCustomers();
                } catch (error) {
                    showToast("Failed to delete customer", true);
                    console.error(error);
                } finally {
                    showLoading(false);
                }
            }
            
            // Stats update
            function updateStats() {
                document.getElementById("total-appointments").textContent = appointments.length;
                document.getElementById("scheduled-count").textContent = appointments.filter((a) => a.status === "scheduled").length;
                document.getElementById("inprogress-count").textContent = appointments.filter((a) => a.status === "in_progress").length;
                document.getElementById("released-count").textContent = appointments.filter((a) => a.status === "released").length;
            }
            
            // Calendar rendering and summary
            function renderCalendar() {
                const calendarGrid = document.getElementById("calendar-days");
                calendarGrid.innerHTML = "";
                
                document.getElementById("current-month-year").textContent = 
                    new Date(currentYear, currentMonth).toLocaleString("default", {
                        month: "long",
                        year: "numeric"
                    });
                
                const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                daysOfWeek.forEach((day) => {
                    const dayHeader = document.createElement("div");
                    dayHeader.className = "calendar-day-header";
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });
                
                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const totalDays = new Date(currentYear, currentMonth + 1, 0).getDate();
                
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement("div");
                    emptyCell.className = "calendar-day empty";
                    calendarGrid.appendChild(emptyCell);
                }
                
                for (let day = 1; day <= totalDays; day++) {
                    const dayCell = document.createElement("div");
                    dayCell.className = "calendar-day";
                    
                    const dayNumber = document.createElement("div");
                    dayNumber.className = "day-number";
                    dayNumber.textContent = day;
                    dayCell.appendChild(dayNumber);
                    
                    // Get appointments for this day
                    const dayApps = appointments.filter(app => {
                        if (!app.dateObj) return false;
                        const d = app.dateObj;
                        return d.getDate() === day && 
                               d.getMonth() === currentMonth && 
                               d.getFullYear() === currentYear;
                    });
                    
                    if (dayApps.length > 0) {
                        const container = document.createElement("div");
                        container.className = "calendar-appointments";
                        
                        dayApps.forEach(app => {
                            const item = document.createElement("div");
                            item.className = "appointment-item";
                            item.textContent = `${app.customer.split(" ")[0]} - ${app.dateObj.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                            container.appendChild(item);
                        });
                        
                        dayCell.appendChild(container);
                    }
                    
                    calendarGrid.appendChild(dayCell);
                }
            }
            
            function updateCalendarSummary() {
                const monthlyApps = appointments.filter((app) => {
                    if (!app.dateObj) return false;
                    const d = app.dateObj;
                    return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                });
                
                const businessDays = getBusinessDays(currentMonth, currentYear);
                const monthlyRevenue = monthlyApps
                    .filter((a) => a.status === "released")
                    .reduce((sum, a) => sum + (a.price || 0), 0);
                
                document.getElementById("summary-total").textContent = monthlyApps.length;
                document.getElementById("summary-days").textContent = businessDays;
                document.getElementById("summary-revenue").textContent = `$${monthlyRevenue}`;
                
                const utilizationRate = Math.min(100, Math.round((monthlyApps.length / (businessDays * 3))) * 100);
                document.getElementById("summary-utilization").textContent = utilizationRate + "%";
            }
            
            function getBusinessDays(month, year) {
                let count = 0;
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const d = new Date(year, month, day);
                    if (d.getDay() !== 0 && d.getDay() !== 6) count++;
                }
                return count;
            }
            
            // Chart.js setup
            function initChart() {
                const ctx = document.getElementById("appointmentsChart").getContext("2d");
                
                // Destroy existing chart if it exists
                if (chartInstance) {
                    chartInstance.destroy();
                }
                
                const counts = {
                    draft: appointments.filter((a) => a.status === "draft").length,
                    scheduled: appointments.filter((a) => a.status === "scheduled").length,
                    in_progress: appointments.filter((a) => a.status === "in_progress").length,
                    released: appointments.filter((a) => a.status === "released").length,
                    cancelled: appointments.filter((a) => a.status === "cancelled").length,
                };
                
                chartInstance = new Chart(ctx, {
                    type: "doughnut",
                    data: {
                        labels: ["Draft", "Scheduled", "In Progress", "Completed", "Cancelled"],
                        datasets: [{
                            data: Object.values(counts),
                            backgroundColor: [
                                "rgba(149, 165, 166, 0.7)",
                                "rgba(93, 93, 255, 0.7)",
                                "rgba(52, 152, 219, 0.7)",
                                "rgba(46, 204, 113, 0.7)",
                                "rgba(231, 76, 60, 0.7)",
                            ],
                            borderColor: [
                                "rgba(149, 165, 166, 1)",
                                "rgba(93, 93, 255, 1)",
                                "rgba(52, 152, 219, 1)",
                                "rgba(46, 204, 113, 1)",
                                "rgba(231, 76, 60, 1)",
                            ],
                            borderWidth: 1,
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "right",
                                labels: { color: "#333", font: { size: 12 } },
                            },
                            title: {
                                display: true,
                                text: "Appointment Status Distribution",
                                color: "#333",
                                font: { size: 16 },
                            },
                        },
                    },
                });
            }
            
            // ================ MODAL MANAGEMENT ================
            function openEditModal(id) {
                const app = appointments.find((a) => a.id === id);
                if (!app) return;
                
                editingAppointmentId = id;
                
                document.getElementById("customer-name").value = app.customer;
                document.getElementById("customer-phone").value = app.phone || "";
                
                // Use the dateObj for editing
                const dateObj = app.dateObj || new Date();
                document.getElementById("appointment-date").value = dateObj.toISOString().split("T")[0];
                
                // Format time as HH:MM
                const hours = dateObj.getHours().toString().padStart(2, '0');
                const minutes = dateObj.getMinutes().toString().padStart(2, '0');
                document.getElementById("appointment-time").value = `${hours}:${minutes}`;
                
                document.getElementById("equipment").value = app.equipment || "";
                document.getElementById("appointment-price").value = app.price || 150;
                document.getElementById("issue-description").value = app.issue || "";
                document.getElementById("repair-notes").value = app.repair_notes || "";
                document.getElementById("appointment-status").value = app.status || "";
                
                document.getElementById("modal-title").textContent = "Edit Appointment";
                document.getElementById("save-appointment").textContent = "Update Appointment";
                
                document.getElementById('appointment-modal').classList.add('active');
            }
            
            function openAddModal() {
                editingAppointmentId = null;
                
                document.getElementById("appointment-form").reset();
                
                const today = new Date();
                document.getElementById("appointment-date").value = today.toISOString().split("T")[0];
                
                const nextHour = new Date(today.getTime() + 60 * 60 * 1000);
                document.getElementById("appointment-time").value = `${nextHour.getHours().toString().padStart(2, "0")}:${nextHour.getMinutes().toString().padStart(2, "0")}`;
                
                document.getElementById("appointment-price").value = 150;
                document.getElementById("modal-title").textContent = "Add New Appointment";
                document.getElementById("save-appointment").textContent = "Save Appointment";
                
                document.getElementById('appointment-modal').classList.add('active');
            }
            
            function closeAppointmentModal() {
                document.getElementById('appointment-modal').classList.remove('active');
            }
            
            function openAddCustomerModal() {
                editingCustomerId = null;
                document.getElementById('customer-form').reset();
                document.getElementById('customer-modal-title').textContent = "New Customer";
                document.getElementById('customer-modal').classList.add('active');
            }
            
            function openEditCustomerModal(id) {
                const customer = customers.find(c => c.id === id);
                if (!customer) return;
                
                editingCustomerId = id;
                document.getElementById('customer-name').value = customer.name || '';
                document.getElementById('customer-phone').value = customer.phone || '';
                document.getElementById('customer-email').value = customer.email || '';
                document.getElementById('customer-address').value = customer.address || '';
                document.getElementById('customer-notes').value = customer.notes || '';
                
                document.getElementById('customer-modal-title').textContent = "Edit Customer";
                document.getElementById('customer-modal').classList.add('active');
            }
            
            function closeCustomerModal() {
                document.getElementById('customer-modal').classList.remove('active');
            }
            
            // ================ EVENT LISTENERS ================
            function setupEventListeners() {
                // Sidebar navigation
                document.querySelectorAll(".nav-links a").forEach(link => {
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        const view = link.dataset.view;
                        activateView(view);
                    });
                });
                
                // Logout button
                document.querySelector('.nav-links a[data-view="logout"]').addEventListener("click", (e) => {
                    e.preventDefault();
                    logout();
                });
                
                // Top tab navigation
                document.querySelectorAll(".tab").forEach(tab => {
                    tab.addEventListener("click", () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        activateView(tab.dataset.tab);
                    });
                });
                
                // Month navigation buttons
                document.getElementById("prev-month").addEventListener("click", () => {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar();
                    updateCalendarSummary();
                });
                
                document.getElementById("next-month").addEventListener("click", () => {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar();
                    updateCalendarSummary();
                });
                
                // Appointment pagination
                document.getElementById("prev-page").addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderAppointmentsTable();
                    }
                });
                
                document.getElementById("next-page").addEventListener("click", () => {
                    const totalPages = Math.ceil(appointments.length / appointmentsPerPage);
                    if (currentPage < totalPages) {
                        currentPage++;
                        renderAppointmentsTable();
                    }
                });
                
                // Search functionality
                document.getElementById("search-appointments").addEventListener("input", function () {
                    const keyword = this.value.toLowerCase();
                    const filtered = appointments.filter(
                        (app) => app.customer.toLowerCase().includes(keyword) ||
                                 (app.phone && app.phone.toLowerCase().includes(keyword))
                    );
                    currentPage = 1;
                    renderAppointmentsTable(filtered);
                });
                
                // Print button
                document.getElementById("print-schedule").addEventListener("click", () => {
                    window.print();
                });
                
                // Add appointment button
                document.getElementById("add-appointment").addEventListener("click", openAddModal);
                
                // Save appointment button
                document.getElementById("save-appointment").addEventListener("click", async () => {
                    const customerName = document.getElementById("customer-name").value.trim();
                    const phone = document.getElementById("customer-phone").value.trim();
                    const dateInput = document.getElementById("appointment-date").value;
                    const timeInput = document.getElementById("appointment-time").value;
                    const dateObj = new Date(`${dateInput}T${timeInput}`);
                    const timestamp = Timestamp.fromDate(dateObj);
                    const equipment = document.getElementById("equipment").value.trim();
                    const price = parseFloat(document.getElementById("appointment-price").value) || 0;
                    const issue = document.getElementById("issue-description").value.trim();
                    const status = document.getElementById("appointment-status").value;
                    const repairNotes = document.getElementById("repair-notes").value.trim();
                    
                    if (!customerName) {
                        showToast("Please enter customer name", true);
                        return;
                    }
                    if (!dateInput || !timeInput) {
                        showToast("Please select date and time", true);
                        return;
                    }
                    
                    const appointmentData = {
                        customer: customerName,
                        phone,
                        equipment,
                        date: timestamp,
                        price,
                        issue,
                        status,
                        repair_notes: repairNotes,
                    };
                    
                    await saveAppointment(appointmentData);
                });
                
                // Modal controls
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        closeAppointmentModal();
                        closeCustomerModal();
                    });
                });
                
                document.getElementById("cancel-appointment").addEventListener("click", closeAppointmentModal);
                
                // Customer modals
                document.getElementById('add-customer').addEventListener('click', openAddCustomerModal);
                document.getElementById('save-customer').addEventListener('click', saveCustomer);
                document.getElementById('cancel-customer').addEventListener('click', closeCustomerModal);
                
                // Settings
                document.getElementById('save-settings').addEventListener('click', () => {
                    showToast("Settings saved successfully");
                });
                
                document.getElementById('reset-settings').addEventListener('click', () => {
                    document.getElementById("company-name").value = "Canadian Fitness Repair";
                    document.getElementById("default-price").value = "150";
                    document.getElementById("business-hours").value = "9:00 AM - 6:00 PM";
                    document.getElementById("enable-past-edits").value = "true";
                    showToast("Settings reset to defaults");
                });
            }
            
            // ================ INITIALIZATION ================
            function initialize() {
                setupEventListeners();
                activateView('dashboard');
                
                // Set default date for appointment form
                const today = new Date();
                document.getElementById("appointment-date").value = today.toISOString().split("T")[0];
                const nextHour = new Date(today.getTime() + 60 * 60 * 1000);
                document.getElementById("appointment-time").value = `${nextHour.getHours().toString().padStart(2, "0")}:${nextHour.getMinutes().toString().padStart(2, "0")}`;
            }
            
            // Start the application
            initialize();
        }
    </script>
</body>
</html>